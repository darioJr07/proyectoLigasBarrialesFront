<div class="page-container">
  <header class="page-header">
    <h1>Sistema de Ligas Barriales</h1>
    <div class="user-info" *ngIf="user$ | async as user">
      <span>{{ user.nombre }}</span>
      <span class="user-role">({{ user.rol.nombre }})</span>
      <button class="btn-logout" (click)="logout()">Cerrar SesiÃ³n</button>
    </div>
  </header>

  <app-main-nav></app-main-nav>

  <div class="campeonatos-container">
    <div class="header">
      <h2>GestiÃ³n de Campeonatos</h2>
      <button *ngIf="canCreate()" class="btn-primary" routerLink="/campeonatos/nuevo">
        <span class="icon">+</span> Nuevo Campeonato
      </button>
    </div>

    <!-- Filtros (solo para master y directivo_liga) -->
    <div *ngIf="canShowFilters() && !loading && campeonatos.length > 0" class="filters-container">
      <div class="filters-row">
        <!-- Filtro de Liga (solo para master) -->
        <div class="filter-group" *ngIf="isMaster">
          <label for="ligaFilter">Liga:</label>
          <select 
            id="ligaFilter"
            [(ngModel)]="selectedLigaId"
            (change)="onLigaChange()"
            class="filter-select">
            <option value="">Todas las ligas</option>
            <option *ngFor="let liga of ligas" [value]="liga.id">
              {{ liga.nombre }}
            </option>
          </select>
        </div>

        <!-- Filtro de Estado -->
        <div class="filter-group">
          <label for="estadoFilter">Estado:</label>
          <select 
            id="estadoFilter"
            [(ngModel)]="selectedEstado"
            (change)="onEstadoChange()"
            class="filter-select">
            <option value="">Todos los estados</option>
            <option value="inscripcion_abierta">InscripciÃ³n Abierta</option>
            <option value="en_curso">En Curso</option>
            <option value="finalizado">Finalizado</option>
            <option value="cancelado">Cancelado</option>
          </select>
        </div>

        <!-- BotÃ³n para limpiar filtros -->
        <button 
          *ngIf="selectedLigaId || selectedEstado || searchTerm"
          class="btn-clear-filters"
          (click)="clearFilters()"
          title="Limpiar todos los filtros">
          ğŸ—‘ï¸ Limpiar filtros
        </button>
      </div>
    </div>

    <!-- Barra de bÃºsqueda -->
    <div class="search-container" *ngIf="canShowFilters() && !loading && campeonatos.length > 0">
      <div class="search-box">
        <span class="search-icon">ğŸ”</span>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (input)="onSearch()"
          placeholder="Buscar por nombre, descripciÃ³n o liga..."
          class="search-input"
        />
        <button *ngIf="searchTerm" (click)="clearFilters()" class="clear-btn" title="Limpiar bÃºsqueda">
          âœ•
        </button>
      </div>
      <div *ngIf="searchTerm || selectedLigaId || selectedEstado" class="search-info">
        {{ filteredCampeonatos.length }} de {{ campeonatos.length }} campeonato(s)
      </div>
    </div>

    <div *ngIf="loading" class="loading">
      Cargando campeonatos...
    </div>

    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <div *ngIf="!loading && filteredCampeonatos.length === 0 && !searchTerm && !selectedLigaId && !selectedEstado" class="empty-state">
      <p>No hay campeonatos registrados</p>
      <button *ngIf="canCreate()" class="btn-secondary" routerLink="/campeonatos/nuevo">
        Crear primer campeonato
      </button>
    </div>

    <div *ngIf="!loading && filteredCampeonatos.length === 0 && (searchTerm || selectedLigaId || selectedEstado)" class="empty-state">
      <p>No se encontraron campeonatos con los criterios seleccionados</p>
      <button class="btn-secondary" (click)="clearFilters()">
        Limpiar filtros
      </button>
    </div>

    <div *ngIf="!loading && filteredCampeonatos.length > 0" class="campeonatos-grid">
      <div *ngFor="let campeonato of filteredCampeonatos" class="campeonato-card" [class.inactive]="!campeonato.activo">
        <div class="campeonato-header">
          <h3>{{ campeonato.nombre }}</h3>
          <span class="status-badge" [ngClass]="getEstadoClass(campeonato.estado)">
            {{ getEstadoTexto(campeonato.estado) }}
          </span>
        </div>
        <div class="campeonato-info">
          <p><strong>Liga:</strong> {{ campeonato.liga?.nombre }}</p>
          <p *ngIf="campeonato.descripcion" class="descripcion">{{ campeonato.descripcion }}</p>
          <p><strong>Inicio:</strong> {{ campeonato.fechaInicio | date:'dd/MM/yyyy' }}</p>
          <p><strong>Fin:</strong> {{ campeonato.fechaFin | date:'dd/MM/yyyy' }}</p>
          <p><strong>LÃ­mite inscripciÃ³n:</strong> {{ campeonato.fechaLimiteInscripcion | date:'dd/MM/yyyy' }}</p>
        </div>
        <div class="campeonato-actions">
          <button class="btn-icon" (click)="verCategorias(campeonato.id)" title="Ver CategorÃ­as">
            ğŸ“‹
          </button>
          <button class="btn-icon" (click)="verInscripciones(campeonato.id)" title="Ver Inscripciones">
            ğŸ“
          </button>
          <button *ngIf="canEdit()" class="btn-icon" (click)="editarCampeonato(campeonato.id)" title="Editar">
            âœï¸
          </button>
          <button *ngIf="canEdit()" class="btn-icon danger" (click)="eliminarCampeonato(campeonato.id)" title="Deshabilitar">
            ğŸ—‘ï¸
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
